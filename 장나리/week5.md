# WEEK 5

## CHAPTER 06: AWS 서버 환경을 만들어보자 - AWS EC2

AWS라는 클라우드 서비스를 이용해 본격적으로 서버 배포 진행해보자!!

24시간 작동하는 서버가 필요 → 3가지 선택지

1. 집에 PC를 24시간 구동
2. 호스팅 서비스(Cafe 24, 코리아호스팅 등)
3. 클라우드 서비스(AWS, AZURE, GCP 등)
- 일반적으로 호스팅 서비스나 집 PC가 저렴
- 특정 시간에만 트래픽이 몰린다면 유동적으로 사양을 늘릴 수 있는 클라우드가 유리
- 클라우드 서비스 : 인터넷(클라우드)을 통해 서버, 스토리지(파일 저장소), 데이터베이스, 네트워크, 소프트웨어, 모니터링 등의 컴퓨팅 서비스를 제공하는 것.
- AWS의 EC2는 서버 장비를 대여하는 것이지만, 실제로는 그안의 로그 관리, 모니터링, 하드웨어 교체, 네트워크 관리 등을 기본적으로 지원
- 클라우드 형태
    1. Infrastructure as a Service(IaaS, 아이아스, 이에스)
        - 기존 물리 장비를 미들웨어와 함께 묶어둔 추상화 서비스
        - 가상머신, 스토리지, 네트워크, 운영체제 등의 IT 인프라를 대여해주는 서비스
        - AWS의 EC2, S3 등
    2. Platform as a Service(Paas, 파스)
        - 앞에서 언급한 Iaas에서 한 번 더 추상화한 서비스
        - 많은 기능이 자동화 되어 있음
        - AWS의 Beanstalk(빈스톡), Heroku(헤로쿠) 등
    3. Software as a Service(Saas, 사스)
        - 소프트웨어 서비스
        - 구글 드라이브, 드랍박스, 와탭 등
- 여러 클라우드 서비스 중 AWS를 선택한 이유
    - 첫 가입시 1년간 대부분서비스가 무료, 서비스마다 제한이 있긴 함
    - 클라우드에서는 기본적으로 지원하는 기능(모니터링, 로그관리, 백업, 복구, 클러스터링 등등)이 많아 개인이나 소규모일 때 개발에 좀 더 집중할 수 있음
    - 많이 기업이 AWS로 이전 중이기 때문에 이직 할 때 AWS 사용 경험은 도움이 됨. 국내에서는 AWS 점유율이 압도적, 쿠팡, 우아한 형제들, 리멤버 등 클라우드를 사용할 수 있는 회사에서는 대부분 AWS 사용
    - 사용자가 많아 국내 자료와 커뮤니티가 활성화되어 있음
- 이 책에서 진행하는 모든 AWS 서비스는 Iaas 사용
    - AWS의 PaaS 서비스인 빈스톡을 사용하면 대부분 작업이 간소화되지만, 프리티어로 무중단 배포가 불가능

---

### 6.1 AWS 회원가입

Master 혹은 Visa 카드 필요

---

### 6.2 EC2 인스턴스 생성하기

EC2 : AWS에서 제공하는 성능, 용량 등을 유동적으로 사용할 수 있는 서버

보통 “AWS에서 리눅스 서버 혹은 윈도우 서버를 사용한다” → EC2를 이야기 하는 것

프리티어 플랜에서는 EC2 사용에 제한이 있음

- 사양이 t2.micro만 가능
    - vCPU(가상 CPU) 1 Core, 메모리 1GB tkdid
    - 보통 vCPU는 물리 CPU 사양의 절반 정도의 성능
- 월 750시간 제한, 초과하면 비용 부과
    - 1대의 t2.micro만 사용한다면 24시간 사용 가능

EC2를 만들기 전에 본인의 리전 확인 → AWS의 서비스가 구동될 지역, AWS는 도시별로 클라우드 센터를 지어 해당 센터에서 구축된 가상머신들을 사용 할 수 있다. → 서울로 변경

EC2 대시보드 → 인스턴스 시작

- AMI(Amazon Machine Image, 아마존 머신 이미지) 선택 → Amazon Linux AMI
    - EC2 인스턴스를 시작하는 데 필요한 정보를 이미지로 만들어 둔 것
    - 인스턴스라는 가상 머신에 운영체제 등을 설치 할 수 있게 구워넣은 이미지로 생각
    - 아마존 리눅스 2 대신에 1인 이유
        - 아직 국내 자료가 리눅스 1이 더 많음
    - 보통 센토스 6버전으로 진행되는 자료들은 아마존 리눅스 1에서 모두 사용 가능
    - 아마존 리눅스 2는 센토스 7버전 자료들을 그대로 사용가능
    - 굳이 센토스 AMI를 사용하지 않고 아마존 리눅스 AMI를 사용하는 이유
        - 아마존이 개발하고 있기 때문에 지원받기 쉬움
        - 레드햇 베이스이므로 레드햇 계열의 배포판을 많이 다뤄본 사람일수록 문제없이 사용 가능
        - AWS의 각종 서비스와의 상성이 좋음
        - Amazon 독자적이 개발 리포지터리를 사용하고 있어 yum이 매우 빠름
- 인스턴스 유형 → 프리티어로 표기된 t2.micro
    - t2 : 요금 타입, T 시리즈
    - micro : 사양
    - T시리즈는 다른 서비스와 달리 크레딧이라느 일종의 CPU를 사용할 수 있는 포인트 개념이 있음
        - 인스턴스 크기에 따라 정해진 비율로 CPU 크레딧을 계속 받게 되며, 사용하지 않을 때는 크레딧을 축적하고, 사용할 때 이 크레딧 사용
        - 정해진 사양보다 더 높은 트래픽이 오면 크레딧을 좀 더 적극적으로 사용하면서 트래픽 처리
        - 크레딧이 모두 사용되면 더이상 EC2를 사용할 수 없음
        - 트래픽이 높은 서비스는 T 시리즈를 쓰지 않고 다른 시리즈를 사용하기도
- 세부정보 구성
- 네트워크 설정 → SSH 트래픽 허용 : 내 IP
- 스토리지 설정 → 30GB
- 키페어 → nari-springboot-webservice

인스턴스도 IP 존재 → 중지했다가 다시 시작할 때도 새 IP가 할당 → 고정 IP 가지도록

- EIP(Elastic, 탄력적) 할당
    - 네트워크 및 보안 → 탄력적 IP → 탄력적 IP 주소 할당 → 할당
    - 탄력적 IP와 EC2 주소 연결 : 작업 버튼 → 탄력적 IP 주소 연결
    - 생성하고 EC2 서버에 연결하지 않으면 비용 발생

---

### 6.3 EC2 서버에 접속

Mac은 터미널로 진행

`ssh-keygen` : ./ssh파일 생성

`cp <pem 키를 내려받은위치> ~/.ssh` : ./ssh 파일에 pem 파일 복사

`chmod 600 ~/.ssh/pem키 이름` : 권한 변경

`vim ~/.ssh/config` : ~/.ssh 디렉토리에 config 파일 생성

→ Host 본인이 원하는 서비스명

HostName ec2의 탄력적 IP 주소

User ec2-user

IdentityFile ~/.ssh/pem키 이름

작성이 안료되면 :wq 명령어로 종료

`chmod 700 ~/.ssh/config` : 실행권한 부여 

`ssh config에 등록한 서비스명` : 접속

---

### 6.4 아마존 리눅스 1 서버 생성 시 꼭 해야 할 설정들

근데 아마존 리눅스1은 지원이 끝난 것 같고, 제가 amazon linux 2023으로 하고 있던 것 같아서 이에 맞춰서 진행했습니다

- java 8 버전 설치
    - `sudo yum install -y java-1.8.0-amazon-corretto-devel.x86_64`
- 타임존 변경 : 기본 서버 시간은 미국 시간대. 한국 시간대가 되어야만 우리가 사용하는 시간이 모두 한국시간으로 등록되고 사용됨
    - `sudo rm /etc/localtime`
    - `sudo ln -s /usr/share/zoneinfo/Asia/Seoul /etc/localtime`
- 호스트네임 변경 : 현재 접속한 서버의 별명 등록. 실무에서는 한 대의 서버가 아닌 수십대의 서버가 작동되는데, IP 만으로 어떤 서버가 어떤 역할을 하는지 알 수 없음
    - `sudo hostnamectl set-hostname <원하는 서비스 명>`
    - `sudo reboot`

---

### 과제

1. 클라우드 컴퓨팅이란
    - 컴퓨팅 리소스를 인터넷을 통해 서비스로 사용할 수 있는 주문형 서비스
    - 기업에서 직접 리소스를 조달하거나 구성, 관리할 필요가 업으며 사용한 만큼만 비용을 지불하면 됨
    - 클라우드 컴퓨팅의 이점
        - 유연성
            - 기업과 사용자가 인터넷만 연결되면 어디서나 클라우드 서비스에 액세스하고 필요에 따라 서비스를 확장하거나 축소 가능
        - 효율적
            - 기업에서 기본 인프라에 대한 걱정없이 새로운 애플리케이션을 개발하여 빠르게 프로덕션에 배포 가능
        - 전략적 가치 제공
            - 클라우드 제공업체에서 최신 혁신 기술을 앞서 받아들인 후 고객에게 서비스 형태로 제공하기 때문에 기업에서 경쟁력을 강화하고 쓸모 없어진 기술에 투자했더라도 투자 수입 높일 수 있음
        - 보안
            - 보안 위험은 비교적 낮음. 클라우드 공급 업체에 사용되는 보안 메커니즘의 수준 및 범위로 인해 기업 내 데이터 센터보다 강력.
            - 클라우드 공급업체의 보안팀은 업계에서 최고 수준의 전문가들
        - 비용 효율성
            - 어떤 클라우드 컴퓨팅 서비스 모델을 사용하든 기업은 사용하는 컴퓨팅 리소스에 대해서만 비용 지불
            - 예상치 못한 수요 급증이나 비즈니스 성장을 대비하여 데이터 센터 용량을 과도하게 구성할 필요 없음
    - 클라우드 형태
        1. Infrastructure as a Service(IaaS, 아이아스, 이에스)
            - 기존 물리 장비를 미들웨어와 함께 묶어둔 추상화 서비스
            - 가상머신, 스토리지, 네트워크, 운영체제 등의 IT 인프라를 대여해주는 서비스
            - AWS의 EC2, S3 등
        2. Platform as a Service(Paas, 파스)
            - 앞에서 언급한 Iaas에서 한 번 더 추상화한 서비스
            - 많은 기능이 자동화 되어 있음
            - AWS의 Beanstalk(빈스톡), Heroku(헤로쿠) 등
        3. Software as a Service(Saas, 사스)
            - 소프트웨어 서비스
            - 구글 드라이브, 드랍박스, 와탭 등
2. EC2, RDS 외의 AWS의 다른 서비스들
    - RDS(관계형 데이터 베이스 서비스)
    - S3 (정적 파일 관리)
        - 오브젝트/정적 파일 스토리지 서비스(사진, 비디오, 문서 등 또는 코드 파일)
        - 간편한 데이터 관리 및 액세스 제어
        - 비용 효율적인 다양한 스토리지 클래스 & 백업 및 복원 솔루션 제공
    - IAM Console (사용자 설정 및 액세스 관리)
        - AWS 서비스 관련 액세스와 권한 설정하는  “Key”관리 서비스
        - 사용 방법 무조건 알아야 함
        - 개발 사용을 위해서 AWS계정의 root가 아닌 다른 사용자 및 그룹 수준 권한을 설정하여 따로 사용자 ID 설정을 통한 이용 권장
    - Route 53 (DNS 설정)
        - Domain Name System(DNS) 도메인 관리 및 설정 서비스
        - EC2 인스턴스, Elastic 로드 밸런서, S3 저장소 등 AWS 서비스 인프라에 효과적으로 연결
    - Elastic Beanstalk (배포를 돕는 PaaS 같은 서비스)
        - 애플리케이션 배포를 간편히 관리해주는 서비스
        - 코드를 업로드하기만 하면 Elastic Beanstalk가 용량 프로비저닝, 로드 밸런싱, Auto Scaling 부터 시작하여 애플리케이션 상태 모니터링에 이르기까지 자동으로 처리
    - CloudFront (AWS의 CDN솔루션)
        - CDN : Content delivery network, 콘텐츠 전송 네트워크
        - 빠른 콘텐츠 전송을 위한 글로벌 규모의 네트워크: 강력한 네트워크 상의 cache 세팅을 통하여 거리 관련 콘텐츠 로드 지연을 최소화
        - S3, EC2, Elastic Load Balancing, Route 53 등과 같은 AWS 서비스와 통합되어 운영
        - 국제적인 기관들에 필수!
    - Lambda (AWS의 serverless compute service)
        - 서버 인프라를 프로비저닝하거나 관리할 필요 없이 Lambda 기능을 선호 언어 (Node.js, Python, Go, Java 등)로 작성하고 AWS 서비스에 업로드하여 코드를 자동으로 트리거하도록 설정하거나 웹 또는 모바일 앱에서 직접 코드를 호출
    - Lightsail (편리한 단일 가상 서버)
        - 편의적인 one-click “서버 세팅” 종류 서비스
        - 주어진 리소스 옵션(Ubuntu, Node, Lamp stack, Nginx, WordPress, Django.. etc) 중 하나를 택하여 단일 가상 서버를 쉽게 설정
        - 스토리지, 데이터베이스 및 CDN 등 간소하지만 종합적 서비스 제공
