## Chapter 6 : AWS 서버 환경 만들기 - AWS EC2

- AWS 클라우드 서빗 이용하여 서버 배포 진행
- 외부에서 내가 만든 서비스에 접근 -> 24시간 동작하는 서버 필요
- 24시간 동작하는 서버
  - 집에 PC 24시간 구동
  - 호스팅 서비스 이용
  - 클라우드 서비스 이용
- 비용은 호스팅 서비스나 집 PC 이용하는 것이 저렴
- 특정 시간에만 트래픽 몰린다면 유동적으로 사양 늘릴 수 있응 클라우드 유리
- 클라우드 서비스
  - 인터넷(클라우드) 통해 서버, 스토리지, 데이터베이스, 네트워크 , 소프트웨어, 모니터링 등의 컴퓨터 서비스 제공
  - IaaS : 물리 장비 + 미들웨어 묶은 추상화 서비스
    - IT 인트라 대여해주는 서비스
    - AWS의 EC2, S3
  - PaaS : IaaS에서 한번 더 추상화한 서비스
    - 많은 기능 자동화
    - AWS의 Beanstalk, Heroku
  - SaaS : 소프트웨어 서비스
    - 구글 드라이브, 드랍박스, 와탭

### [1] AWS 회원가입

1. AWS 공식 사이트(https://aws.amazon.com/ko/) 접속 후 무료 계정 생성
   - 계정 유형 : 개인
   - 지원 플랜 : 기본 무료 지원
2. 회원가입 완료 후 루트 사용자 로그인

### [2] EC2 인스턴스 생성

1. EC2(Elastic Compute Cloud)
   - AWS에서 제공하는 서버
   - 리전 확인 후 서울로 변경
   - EC2 대시 보드 > 인스턴스(EC2 서지스에서 생성된 가상 머신) 시작 클릭
2. 인스턴스 생성
   - AMI(Amazon Machine Image) 선택 : EC2 인스턴스 시작하는 데 필요한 정보 이미지로 만들어 둔 것
     - Amazon Linux AMI 선택
   - 인터턴스 유형 선택
     - t2.micro 선택
     - t2 : 요금 타입 / micro : 사양
     - 크레딧이라는 일종의 CPU 사용 가능
     - 크레딧 모두 사용되면 EC2 더이상 사용 X

- 인스턴스 세부정보 구성
- 스토리지 구성
  - 스토리지 : 하드디스크
  - 서버의 용량 정하는 단계
  - 8GB(기본값) -> 30GB까지 프리티어로 가능
- 태그 추가
  - 웹 콘솔에서 표기될 태그인 Name 태그 등록
  - 해당 인스턴스 표현하는 이름(EC2 이름)
- 보안그룹(방화벽)
  - SSH + 포트 항목 22 : AWS EC2에 터미널로 접속할 때를 의미
  - 현재 장소의 IP 기본적으로 추가
- 할당할 pem키 생성

3. EIP 할당

- 인스턴스 생성 시 항상 새 IP 할당
- 인스턴스 중지하고 다시 시작 시에고 새 IP 할당됨
- 매번 접속해야 하는 IP가 변경되어 PC에서 접근 할때마다 IP 주소 확인
- 매번 IP 변경되지 않응 고정 IP를 가지게 햐여 함
- AWS 고정 IP : Elastic IP(EIP)<br>

- 탄력적 IP 선택 > 새 주소 할당
- EC2 주소와 연결

4. 주의점

- 생선한 탄력적 IP는 생성 후 EC2 서버에 연결하지 않으면 비용 발생
- 무조건 바로 서버에 연결 해야 함
- 더는 사용할 인스턴스가 없다면 삭제햐야 함

### [3] EC2 서버에 연결하기

1. pem 파일 ssh 디렉토리로 복사
   `cp /Users/cindy/Desktop/springboot2-webservice.pem ~/.ssh/`

   - ssh 실행 시 pwm 키 파일 자동으로 읽어 접속 진행

2. pem 키의 권한 변경
   `chmod 600 ~/.ssh/springboot2-webservice.pem`

3. ssh 디렉토리에 config 파일 생성
   `vim ~/.ssh/config`

- 실행 권한 필요하므로 권한 설정 : `chmod 700 ~/.ssh/config`

4. config에 등록한 서비스 연결
   `ssh springboot2-webservice`

### [4] 아마존 리눅스 1 서버 생성 시 꼭 해야 할 설정들

1. Java 8 설치

- 아마존 리눅스 1의 경우 기본 자바 버전이 7 -> 버전 17로 변경
- 자바 17 EC2에 설치 : `sudo yum install java-17-amazon-corretto`
- 설치 확인 : `java --version`

2. 타임존 변경

- EC2 서버 기본 타임존은 UTC
- 한국 시간과 9시간 차이 발생
- 서버 시간 한국시간으로 변경

```
sudo rm /etc/localtime
sudo ln -s /usr/share/zoneinfo/Asia/Seoul /etc/localtime
```

- 타임존 확인 : `date`

3. Hostname 변경

- 여러 서버 관리 중인 경우 IP만으로 어떤 서비스의 서버인지 확인 어려움
- 각 서버가 어떤 서비스인지 표현하기 위해 Hostname 변경
- preserve_hostname cloud-init 설정이 true로 설정되어 있는지 확인
  - `sudo vi /etc/cloud/cloud.cfg`
  - `preserve_hostname: true`
- 편집파일 열기 : `sudo vim /etc/sysconfig/network`
- HOSTNAME 부분 -> 원하는 서비스명으로 변경
- /etc/hosts 파일 수정 : `127.0.0.1 (이름).localdomain (이름) localhost4 localhost4.localdomain4`
- 서버 재부팅 : `sudo reboot`

### [5] 추가 개념

1. 클라우드 컴퓨팅?

- 정의 : 컴퓨팅 리소스를 인터넷을 통해 서비스로 사용할 수 있는 서비스
  - 인터넷을 통해 컴퓨팅 자원, 소프트웨어 등을 공유
- 작동 방식 : 네트워크(인터넷) 이용하여 사용자가 대여 컴퓨팅 서비스 요청 -> 클라우드 플랫폼에 연결
- 클라우드 컴퓨팅의 장점

  1. 유연성 : 인터넷만 연결되면 어디서나 클라우스 서비스에 액세스하고 필요에 따라 서비스 확장하거나 축소 가능
  2. 효율성 : 새로운 애플리케이션의 빠른 개발 -> 프로덕션 빠르게 배포 가능
  3. 보안 : 클라우드 공급업체에 사용되는 보안 수준을 제공하기 때문에 기업 내 데이터 센터보나 강력
  4. 비용 효율성 : 기업은 사용하는 컴퓨팅 리소스에 대해서만 비용 지불

<br>(출처 : Google Cloud)

2. EC2, RDS 외의 AWS의 다른 서비스<br>

- Amazon S3 : 스토리지 서비스
  - 데이터를 구성하고 관리하는 데 사용
  - 데이터는 '버킷'이라는 리소스에 객체로 저장됨(한 객체의 크기는 최대 5TByte)
- AWS Lambda : 컴퓨팅 서비스
  - 모든 유형의 애플리케이션 또는 백엔드 서비스에 대한 코드를 실행할 수 있는 서비스
  - 사용자는 Lambda 기능을 선호 언어 코드만으로 작성하여 서비스 실행 가능
  - 서버리스 모델(Serverless)로 개발자는 서버 인프라를 관리할 필요 없이 개발에만 집중할 수 있음
- Amazon DynamoDB : 데이터베이스 서비스

  - 고성능 애플리케이션을 실행하도록 설계된 완전관리형의 서버리스 키-값 NoSQL 데이터베이스
  - 기존의 관계형 데이터베이스에서 부족했던 인터넷 규모의 고성능 애플리케이션을 실행할 수 있도록 설계
  - 키-값과 문서 데이터 모델을 모두 지원하는 유연한 스키마를 가짐 -> 테이블 스키마를 재정의할 필요 없이 비즈니스 요구사항이 변경되면 테이블 쉽게 조정 가능

  <br>(출처 : AWS)
